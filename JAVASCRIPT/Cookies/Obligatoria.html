<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ejercicio Obligatorio Web Storage</title>
    </head>
    <body>
        <h1>Formulario de Coches</h1>
        <form>
            <label for="matricula">nº Matrícula:</label>
            <input type="text" name="matricula" id="matricula"><br><br>

            <label for="color">Color:</label>
            <input type="text" name="color" id="color"><br><br>

            <label for="marca">Marca:</label>
            <input type="text" name="marca" id="marca"><br><br>

            <button type="button" id="guardar">Guardar coche</button>
            <button type="button" id="eliminar">Eliminar coche</button>
            <button type="button" id="anterior">Ver coche anterior</button>
            <button type="button" id="siguiente">Ver coche siguiente</button>
            <button type="button" id="limpiar">Limpiar formulario</button>

            <p id="demo"></p>
        </form>
        <script>
            let cochesGuardados = JSON.parse(localStorage.getItem("coches")) || [];

            let indice = -1;

            const inputMatricula = document.getElementById("matricula");
            const inputColor = document.getElementById("color");
            const inputMarca = document.getElementById("marca");

            const botonGuardar = document.getElementById("guardar");
            const botonEliminar = document.getElementById("eliminar");
            const botonSiguiente = document.getElementById("siguiente");
            const botonAnterior = document.getElementById("anterior");
            const botonLimpiar = document.getElementById("limpiar");

            function mostrarCoche(index) {
                if (index >= 0 && index < cochesGuardados.length) {
                    const coche = cochesGuardados[index];
                    inputMatricula.value = coche.matricula;
                    inputColor.value = coche.color;
                    inputMarca.value = coche.marca;

                    indice = index;
                } else {
                    inputMatricula.value = "";
                    inputColor.value = "";
                    inputMarca.value = "";
                    indice = -1;
                }
            }

            botonGuardar.addEventListener("click", () => {
                const nuevoCoche = {
                    matricula: inputMatricula.value,
                    color: inputColor.value,
                    marca: inputMarca.value
                };

                if (!nuevoCoche.matricula || !nuevoCoche.color || !nuevoCoche.marca) {
                    alert("Introduce todos los datos, por favor.");
                    return;
                }

                cochesGuardados.push(nuevoCoche);
                localStorage.setItem("coches", JSON.stringify(cochesGuardados));

                alert("Coche guardado correctamente.");
                inputMatricula.value = "";
                inputColor.value = "";
                inputMarca.value = "";
                indice = -1;
            });

            botonSiguiente.addEventListener("click", () => {
                if (cochesGuardados.length === 0) {
                    alert("No hay coches guardados.");
                    return;
                }

                if (indice < cochesGuardados.length - 1) {
                    mostrarCoche(indice + 1);
                }
            })   

            botonAnterior.addEventListener("click", () => {
                if (cochesGuardados.length === 0) {
                    alert("No hay coches guardados.");
                    return;
                }

                if (indice > 0) {
                    mostrarCoche(indice - 1);
                } else {
                    if (indice === -1) mostrarCoche(0);
                }
            })

            botonEliminar.addEventListener("click", () => {
                if (indice === -1) {
                    alert("No hay ningún coche seleccionado.");
                return;
                }

                if (cochesGuardados.length > 0) {
                    cochesGuardados.splice(indice, 1);
                    alert(`Coche ${inputMarca.value} eliminado correctamente.`);

                    localStorage.setItem("coches", JSON.stringify(cochesGuardados));

                    const nuevoIndice = (indice >= cochesGuardados.length) ? cochesGuardados.length - 1 : indice;
                    mostrarCoche(nuevoIndice);
                } else {
                    inputMatricula.value = "";
                    inputColor.value = "";
                    inputMarca.value = "";
                    indice = -1;
                    
                    alert("No quedan coches guardados.");
                }
            });

            botonLimpiar.addEventListener("click", () => {
                inputMatricula.value = "";
                inputColor.value = "";
                inputMarca.value = "";
                indice = -1;
            });
        </script>
    </body>
</html>